% Licensed to the Apache Software Foundation (ASF) under one
% or more contributor license agreements.  See the NOTICE file
% distributed with this work for additional information
% regarding copyright ownership.  The ASF licenses this file
% to you under the Apache License, Version 2.0 (the
% "License"); you may not use this file except in compliance
% with the License.  You may obtain a copy of the License at
%
%   http://www.apache.org/licenses/LICENSE-2.0
%
% Unless required by applicable law or agreed to in writing,
% software distributed under the License is distributed on an
% "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
% KIND, either express or implied.  See the License for the
% specific language governing permissions and limitations
% under the License.

\section{Data Model\label{sec:data-model}}
This section defines the various objects that may be interacted with through the
Traffic Ops API and their respective properties.\\
An object's properties may principally be of several different types:

\begin{itemize}
	\item Integers. Integers may be signed or unsigned, to signify whether or
	not they are capable of being less than zero. Representation formats which
	are incapable of distinguishing integral and floating-point numbers (e.g.
	JSON) or of separately describing signed and unsigned types (e.g. JSON
	again) MUST represent these as numbers. In particular, they MUST NOT be
	represented as string types. Furthermore, they MUST NOT be represented with
	a non-zero decimal component and generally SHOULD NOT be represented with a
	decimal part at all, if possible. Unsigned quantities MUST NOT include a
	sign (even \code{+}, were it supported by the format).

	\item Floating-point numbers. Floating point numbers are guaranteed to have
	a precision of at least 64-bits, but clients SHOULD NOT treat
	representations with a greater apparent precision as if they were more
	precise than 64 bits can offer. Endpoints MUST NOT implement Not-a-Number
	nor either positive or negative Infinity values as floating-point numbers,
	even if the representation format supports them.

	\item Strings. Strings SHOULD always be encoded (along with the rest of the
	representation, if possible) in UTF-8.

	\item Dates/times. As discussed in section \ref{sec:datetime}, these may be
	expressed as either strings in RFC3339 format or as a signed integer number
	of nanoseconds since the Unix epoch if the representation format does not
	support date/time types natively (e.g. JSON).

	\item Booleans. Boolean concepts MUST be represented as boolean data types
	in representations that do support them. For example, in JSON,
	\code{\{"foo":true\}} is acceptable but \code{\{"foo":"true"\}},
	\code{\{"foo":1\}} and especially \code{\{"foo":"1"\}} are all unacceptable.
	In representation formats that do not support boolean types, they may be
	represented as the number zero for "false" and the number one for "true" as
	unsigned integers.

	\item Collections. There are several collection types used to model ATC
	data. Commonly, they all may contain arbitrary data types, but SHOULD NOT
	contain data of more than one type in any representation format.

	\begin{itemize}
		\item Sets. A set is an unordered collection of unique items. The
		contents of a set are not guaranteed to be in any particular order, and
		clients SHOULD NOT expect anything else\footnote{Endpoint authors are,
		however, encouraged to order these consistently for ease of use,
		testing, and debugging. This order need not - and indeed SHOULD NOT be
		documented.} (unless the endpoint provides sorting functionality
		expressly), and in particular SHOULD NOT conclude that a difference in
		ordering indicates that data has changed. If a representation format is
		not capable of expressing set types (e.g. JSON), then sets may be
		expressed as a list array or other more generic collection, but MUST
		NEVER contain duplicates.

		\item Lists/Arrays. A list/array is an \emph{ordered} collection of
		data, and as such the ordering MUST be consistent in representations, as
		well as meaningful.

		\item Maps. A map may be used to associate any non-collection type "key"
		with a "value" of arbitrary type. Maps MUST NOT contain duplicate keys
		in any representation format. If a representation format is not capable
		of representing maps (e.g. JSON), then they may be represented as
		objects where the keys are coerced to property names and their values
		the respective values of those properties.
	\end{itemize}
\end{itemize}

With the "fallback" behavior described for each type above, note that valid
representation formats MUST be capable of representing at least floating-point
values, string values, array/lists of such primitive values, and either nested
object structures or maps.

\subsection{CDNs}
A CDN is a full collection of caching and infrastructural servers and ATC
components required to service distributed requests for content, as well as the
configuration options for the methods of content delivery and the content
delivered therein.

\begin{codelisting}
\captionof{listing}{CDN Object as a TypeScript Interface}
\label{code:datamodel:cdn}
\begin{minted}[tabsize=2]{typescript}
/**
 * A CDN represents a full stack of hardware, components and configuration
 * required to delivery content.
*/
interface CDN {
	/** The numeric IDs of the CDN's cache servers */
	cacheServers: Set<bigint>;
	/** The names of all of the Delivery Services within the CDN */
	deliveryServices: Set<string>;
	/** Whether or not DNSSEC is enabled on the CDN's domain */
	dnssecEnabled: boolean;
	/** The CDN's domain. Must be a valid DNS label. */
	domain: string;
	/** The numeric IDs of the CDN's infrastructure servers */
	infrastructureServers: Set<bigint>;
	/** The Name of a CDN uniquely identifies it. */
	name: string;
	/** The numeric IDs of the CDN's origins */
	origins: Set<bigint>;
	/** The numeric IDs of the Traffic Monitor instances within the CDN */
	trafficMonitors: Set<bigint>;
	/** The numeric IDs of the Traffic Router instances within the CDN */
	trafficRouters: Set<bigint>;
	/**
	 * The numeric IDs of the Traffic Stats instances within the CDN.
	 * @todo Currently TS is a singleton; is there any desire/reason to change?
	*/
	trafficStatsServers: Set<bigint>;
}
\end{minted}
\end{codelisting}

\subsubsection{Cache Servers}
A CDN's collection of Cache Servers is represented as set of Cache Server IDs.

\subsubsection{Delivery Services}
A CDN's collection of Delivery Services is represented as a set of Delivery
Service Names.

\subsubsection{DNSSEC Enabled}
A CDN that has "DNSSEC Enabled" is capable of supporting DNSSEC configurations
on its constituent Delivery Services. This does \emph{not} mean that all DNS
requests through ATC for this CDN's Domain will be secured with DNSSEC.\\
This is a boolean concept and as such is represented by boolean values.

% TODO: is this necessary? or is this more of a Delivery Service thing?
% TODO: this is no longer a CDNs property as per WG discussion, but does it now
% need its own model definition, or is that unnecessary?
% \subsubsection{DNSSEC Keys}
% An array/list of the Zone-Signing and Key-Signing Keys of this CDN. The
% Zone-Signing Key will appear first, followed immediately by the Key-Signing Key

\subsubsection{Domain}
The Top-Level Domain used by the CDN, represented as a string. This MUST be a
uniquely valued property across all CDNs, and MUST not be an invalid DNS label
as defined by
\href{https://tools.ietf.org/html/rfc1035#section-2.3.1}{Section 2.3.1 of RFC1035}.

\subsubsection{Infrastructure Servers}
A CDN's collection of Infrastructure Servers is represented as a set of
Infrastructure Server IDs.

\subsubsection{Name}
A CDN's "Name" is a string that uniquely identifies it among all CDNs. It MUST
NOT be allowed to contain "special characters" - meaning anything other than
alphanumeric characters, spaces, hyphens, colons and underscores. It further
MUST NOT be allowed to begin with a non-alphanumeric character nor end with a
space.

\subsubsection{Origins}
A CDN's collection of Origins is represented by a set of Origin IDs.

\subsubsection{Traffic Monitors}
A CDN's collection of Traffic Monitors is represented by a set of Traffic
Monitor IDs. Note that while a functioning CDN must contain at least one Traffic
Monitor, no such restriction is placed on CDN objects in general.

\subsubsection{Traffic Routers}
A CDN's collection of Traffic Routers is represented by a set of Traffic Router
IDs. Note that while a functioning CDN must contain at least one Traffic Router,
no such restriction is placed on CDN objects in general.

\subsubsection{Traffic Stats Servers}
A CDN's collection of Traffic Stats Servers is represented by a set of Traffic
Stats Server IDs.

\subsection{Cache Groups}
A Cache Group is exactly what it sounds like it is: a group of Cache Servers.
Typically a Cache Group is representative of the available Cache Servers within a
specific geographical location. Despite that Cache Servers have their own
Physical Locations, when Cache Servers are chosen to serve content to a client
based on geographic location the geographic location actually used for
comparisons is that for the Cache Group that contains it, not the geographic
location of the Cache Server itself.

\subsubsection{Cache Servers}
All of the Cache Servers within a Cache Group are represented by a set of their
numeric IDs.

\subsubsection{Latitude}
A Cache Group's Latitude is a floating-point number that simply represents a
Cache Group's geographic latitude on the range [-90, 90] - with the positive
range representing North and the negative range representing South.

\subsubsection{Longitude}
A Cache Group's Longitude is a floating-point number that simply represents a
Cache Group's geographic longitude on the range [-180, 180] - with the positive
range representing East and the negative range representing West.

\subsubsection{Name}
A Cache Group is uniquely identified by its Name, which is a string that MUST
NOT be empty.

\subsubsection{Type}
Cache Groups can only contain one Type of Cache Server, which is herein
reflected by the string constant value of said Type.

\begin{itemize}
	\item \code{EDGE} - This Cache Group may only contain Cache Servers that
		are of the \code{EDGE} Type.
	\item \code{MID} - This Cache Group may only contain Cache Servers that are
		of the \code{MID} Type.
\end{itemize}

\subsection{Cache Servers}
Cache servers are the Mid-and-Edge-tier HTTP caching proxies ultimately
responsible for caching and serving content for a Delivery Service.

\subsubsection{Cache Group}
The Cache Group to which the Cache Server belongs is represented as a string
that uniquely names it.

\subsubsection{Capabilities}
A Cache Server's "Capabilities" express a Cache Server's ability to serve
certain kinds of traffic. They are represented on Cache Server objects as a set
of Capability Names.

\subsubsection{CDN}
The CDN to which a Cache Server belongs is represented by its Name, which
uniquely identifies it.

\subsubsection{Domain\label{sec:server:domain}}
This is the "domain" part of the Cache Server's Fully Qualified Domain Name
(FQDN) as a string. For example, a Cache Server with an FQDN of
\code{github.com} has a Domain of \code{com} and a Cache Server with an FQDN of
\code{trafficcontrol.apache.org} has a Domain of \code{apache.org}.\\
In other words, this is every part of the Cache Server's Fully Qualified Domain
Name that isn't part of its Host Name as defined in Section
\ref{sec:server:hostname}.

\subsubsection{Host Name\label{sec:server:hostname}}
This is the "host" part of the Cache Server's Fully Qualified Domain Name (FQDN)
as a string. For example, a Cache Server with an FQDN of \code{github.com} has a
Host Name of \code{github}, and a Cache Server with an FQDN of
\code{trafficcontrol.apache.org} has a Host Name of \code{trafficcontrol}.\\
In other words, a Cache Server's Host Name is the only part of its FQDN that
is not part of its Domain as defined in Section \ref{sec:server:domain}.\\
This field does NOT need to be unique, though operators are encouraged to make
this - or at least the concatenation \code{\emph{Host Name}.{Domain}} - unique
for ease of operation.

\subsubsection{HTTP Port}
An unsigned number that designates the port on which this Cache Server listens
for incoming HTTP requests. Note that this may be zero, which will cause the
Cache Server to be incapable of serving HTTP traffic.

\subsubsection{HTTPS Port}
An unsigned number that designates the port on which this Cache Server listens
for incoming HTTPS requests. Note that this may be zero, which will cause the
Cache Server to be incapable of serving HTTPS traffic.

\subsubsection{ID}
A Cache Server's "ID" is an unsigned integer that uniquely identifies it among
all Cache Servers. It serves no purpose beyond unique identification of the
Cache Server.

\subsubsection{Interfaces}
Interfaces is a set of objects that represent the network interfaces used by a
Cache Server. This set MUST NOT ever be empty. An Interface's properties are
herein listed.

\paragraph{IP Addresses}
A network interface's IP Addresses are represented as a set of objects containing
the various properties of an IP Address. A network interface MUST always have at
least one IP Address object in this set. Their properties are herein listed.\\
Note that there is no structural distinction made between different IP
versions.

\indent{}\subparagraph{Address}
Address is the actual IP Address being described. This may be represented
internally - by either clients or the server - as an actual network address
type, but MUST be represented in API payloads as a string type - even if the
representation encoding supports native network address types.

\indent{}\subparagraph{Gateway}
Gateway is the IP Address of the network gateway used to access this IP
Address. This may be represented internally - by either clients or the server -
as an actual network address type, but MUST be represented in API payloads as a
string type - even if the representation encoding supports native network
address types.\\
This MUST NOT ever be allowed to be represented as an empty string. However, if
it is a "null"-type, then the implication is that no network gateway is used to
access the IP Address.

\indent{}\subparagraph{Service Address}
Service Address is a boolean that describes whether or not an IP Address is one
on which a Cache Server provides its service. Only one such IP Address is
allowed to exist for a given Cache Server per IP version. That is, a Cache
Server may have one IPv4 Service Address and one IPv6 Service Address, but is
not permitted to have two or more IPv4 Service Addresses.

\paragraph{Max Bandwidth}
This unsigned integer describes the maximum bandwidth - in kb/s - that is
allowed for this interface to be considered "healthy" by Traffic Monitors.\\
This has no effect if this Interface's Monitor value is not True.\\
The value \code{0} has the meaning "no limit".

\paragraph{Monitor}
A boolean that describes whether or not this interface should be monitored by
Traffic Monitor. Note that multiple Interfaces that have True Monitor values
is incompatible with a Health Polling Format value of "astats" or
"astats-dsnames".

\paragraph{MTU}
MTU is an unsigned integer that gives the Interface's Maximum Transmission
Unit. It is recommended that UIs built on the API provide the values 9000
and 1500 for selection only, as other values are very rarely correct. However,
the API itself places no such restrictions on the value, which can be any
unsigned integer or a "null"-type.\\
If the value is a "null"-type, then it is assumed that the interface's MTU is
not known or is not relevant for the Cache Server's operation (common on
non-Service-Address-containing Interfaces).

\paragraph{Name}
The string containing a network interface's Name MUST NOT be allowed to be
empty. It should name the actual network interface device on the Cache Server.
For example, two common Names are "eth0" and "bond0".

\subsubsection{Notes}
This section is an arbitrary string containing miscellaneous, human-friendly
information about the Cache Server. Other ATC components SHOULD NOT parse this
for specific information fields, or expect it to be in a particular format.

\subsubsection{Physical Location}
The Physical Location at which a Cache Server resides is represented by a string
containing its Name.

\subsubsection{Profile}
The Profile used by a Cache Server is represented by a string containing its
Name.

\subsubsection{Revalidation Pending}
This boolean represents whether or not the Cache Server has content revalidation
requests yet to satisfy. When a new Content Revalidation Request is created on
one or more Delivery Services to which this Cache Server is assigned, this will
be set to "true" and updated to "false" when the operation has been completed.
Being "false" does not mean that the content invalidation request(s) performed
by the Cache Server have expired and are no longer in effect.

\subsubsection{Status}
The Cache Server's "Status" is a string constant, which MUST always be one of

\begin{itemize}
	\item \code{ADMIN\_DOWN} - The Cache Server is considered unhealthy and its
	thresholds and connectivity state are not monitored. Its existence is not
	disclosed to Traffic Router(s).
	\item \code{OFFLINE} - The Cache Server is considered unhealthy regardless
	of any thresholds or connectivity state.
	\item \code{ONLINE} - The Cache Server will always be considered healthy
	regardless of any thresholds or connectivity state.
	\item \code{REPORTED} - The Cache Server's health is presented to the
	Traffic Router(s) as it is reported by its various thresholds, as determined
	by the Traffic Monitor(s).
\end{itemize}

\subsubsection{Tags}
A Cache Server's "Tags" are represented as a set of Tag Names.

\subsubsection{Type}
A Cache Server's "Type" is a string constant, which MUST always be one of

\begin{itemize}
	\item \code{EDGE} - This is an Edge-tier Cache Server which acts as a
	reverse proxy.
	\item \code{MID} - This is a Mid-tier Cache Server which acts as a forward
	proxy.
\end{itemize}

\subsubsection{Updates Pending}
This boolean represents whether or not the Cache Server has configuration
updates pending. When such updates are applied, this will be set to "false" by
the Cache Server's ORT/ATSTCCFG instance.


\subsection{Capabilities}


\subsection{Delivery Services}
Delivery Services are, at their most basic, an association between a source of
content and a set of Cache Servers and configuration options used to distribute
that content.

\subsubsection{Common Properties}
Herein described are the properties common to all Delivery Service objects. The
Routing Type of a Delivery Service encapsulates the methods by which clients
may request content routing, and depending on its value the Delivery Service
takes on a set of additional properties. Put simply, these are all different
types of objects that are closely related.\\
This section details all of the properties that are common to \emph{all} types
of Delivery Services.

\paragraph{Anonymous Blocking}
A Delivery Service that has "Anonymous Blocking" tells Traffic Router to block
requests from anonymized IP addresses. Whether or not and how well that can
actually be done is dependent on the configuration of each Traffic Router
itself, and if this Delivery Service is DNS-routed the only IP address Traffic
Routers will be capable of checking for anonymization (e.g. known proxy/VPN/TOR
exit node) will be the downstream router requesting the name resolution and thus
is likely much less effective.

\paragraph{Bypass Destination}
This is a string that describes the network location to which clients will be
directed if the traffic served by this Delivery Service exceeds its allowed
maximums. This MUST always be represented as a string - even if the
representation format supports IP Addresses as a native type - and its
interpretation is dependent on the Delivery Service's Routing Type.\\
If the Delivery Service's Routing Type is \code{HTTP}, then this is interpreted
- and validated by the API - as a Fully Qualified Domain Name (FQDN) optionally
followed by a colon and port number that defines an HTTP server to which client
requests will be directed.\\
If the Delivery Service's Routing Type is \code{DNS} or \code{STATIC}, then if
this is a valid IPv4 address it is assumed to be one and will be presented as an
AA record. If not, and it's a valid IPv6 address, then it is assumed to one and
will be presented as an AAAA record. Finally, it may be an FQDN in which case it
will be presented as a CNAME record. If none of these formats can be validated,
then it MUST be rejected by the API.\\
If the Delivery Service's Routing Type is \code{STEERING}, then this MUST be the
Name of an existing Delivery Service - though it need not name one of this
Delivery Service's Targets.

\paragraph{Deep Caching}
A boolean value that describes whether or not "Deep Caching" may be used for
this Delivery Service.

\paragraph{Caching}
Caching describes how Delivery Service content is cached - if at all. It is a
string content restricted to one of the values:

\begin{itemize}
	\item \code{CACHE} The Delivery Service's content will be cached normally.
	\item \code{RAM\_ONLY} The Delivery Service's content will only be cached
	in RAM block devices.
	\item \code{NO\_CACHE} The Delivery Service's content is proxied through
	Cache Servers without ever being actually cached.
\end{itemize}

\paragraph{CDN}
The CDN to which a Delivery Service belongs is expressed as a string that is the
Name used to uniquely identify it.

%TODO: use-case for check path?

\paragraph{Denied Access Redirect}
This is a string that describes the network location to which clients will be
directed if they are denied access on the basis of Anonymous Blocking and/or
Geographic Limiting settings. This MUST always be represented as a string - even
if the representation format supports IP Addresses as a native type - and its
interpretation is dependent on the Delivery Service's Routing Type.

%TODO: steering and static won't have this?
\paragraph{DSCP}
Sets the
\href{https://tools.ietf.org/html/rfc2474}{Differentiated Services Code Point}
which will be marked on the Delivery Service's traffic. This is an unsigned
integer with a maximum value of 64.

%TODO: Necessary?
%\paragraph{ECS}

\paragraph{Geographic Limiting}
This property describes limitations to the availability of this Delivery
Service's content on the basis of the requesting client's geographic location.
It is a set of strings, each of which is an
\href{https://www.iso.org/obp/ui/#search/code/}{ISO 3166-1} alpha-2 country
code, optionally with ISO 3166-2 subdivisional alphabetic code. This is a "white
list" of countries/subdivisions wherein content is to be made
available\footnote{This property is meant to inform Traffic Router; Cache
Servers cannot be relied upon to approve or deny access on a geographic basis.
Thus, if routing is bypassed, restricted content is totally accessible to
requesting clients.}.\\
Content is \emph{always} available to clients whose IP addresses are found
within the Traffic Routers' Coverage Zone File(s). With that in mind, when this
property is an empty set it means that no geographic regions are "whitelisted"
and thus \emph{only} clients whose IP addresses are found within a Coverage Zone
File will be granted access to content. When this property has a "Null" type,
there is no geographic restriction placed on the Delivery Service's content
access.

%TODO: steering and static won't have this?
\paragraph{Maximum Origin Connections}
This is an unsigned integer which determines the maximum number of connections
that any \emph{one} Cache Server may open to the Delivery Service's Origin.\\
If this is null-typed, it has the special meaning "no limit".

%TODO: use-case for header-rewrite text?

\paragraph{Miss Location}

\paragraph{Name}
A Delivery Service's "Name" is a string that uniquely identifies it among all
Delivery Services. It MUST only contain alphanumerics, hyphens, underscores and
spaces, and MUST NOT begin with a non-alphanumeric character nor end with a
non-alphanumeric character. This is used to generate part of the default request
hostnames by replacing all non-alphanumeric characters with a hyphen.

\paragraph{Notes}
This section is an arbitrary string containing miscellaneous, human-friendly
information about the Delivery Service. Other ATC components SHOULD NOT parse
this for specific information fields, or expect it to be in a particular format.

%TODO: MSO use-case?
\paragraph{Origin}

\paragraph{Query String Handling}

\begin{itemize}
	\item \code{DROP}
	\item \code{IGNORE}
	\item \code{USE}
\end{itemize}

\paragraph{Range Request Handling}
\begin{itemize}
	\item \code{NO\_CACHE}
	\item \code{WHOLE\_OBJECT}
	\item \code{CACHE}
\end{itemize}

%TODO Raw-Remap use-case?
%TODO Regex-Remap use-case?

\paragraph{Required Capabilities}

\paragraph{Routing Name}

%TODO: ANY_MAP use-case?
\paragraph{Routing Type}
After creation, Routing Type is a read-only property.
\begin{itemize}
	\item \code{HTTP}
	\item \code{DNS}
	\item \code{STEERING}
	\item \code{STATIC}
\end{itemize}

\paragraph{Status}
The "Status" of a Delivery Service is a string constant that expresses its
ability to serve content at the present moment in time. It may have one of three
values:

\begin{itemize}
	\item \code{ACTIVE} A Delivery Service that is "active" is one that is
	functionally in service, and fully capable of delivering content. This means
	that its configuration is deployed to Cache Servers and it is available for
	routing traffic.
	\item \code{PRIMED} A Delivery Service that is "primed" has had its
	configuration distributed to the various servers required to serve its
	content. However, the content itself is still inaccessible\footnote{The
	content is not available through normal routing. This does not, though,
	guarantee that Cache Servers do not already have the content stored and/or
	are incapable of serving it if routing is bypassed.}.
	\item \code{INACTIVE} A Delivery Service that is "inactive" is not available
	for routing and has not had its configuration distributed to its assigned
	Cache Servers.
\end{itemize}

\paragraph{Supported Protocols}
This is a set of strings that name protocols served by the Delivery Service.
Note that this is the method used to retrieve content from the caching system,
not the method used for routing. The only protocols officially supported by ATC
are "HTTP" and "HTTPS".\\
This set is case-insensitive, such that if a Delivery Service is created with a
Supported Protocols set containing "HTTP" the resulting set is equivalent to
what would result from creating it with a Supported Protocols set containing
"http". Representations produced by the Traffic Ops API MUST always use
only uppercase characters.

\paragraph{Tenant}
The Tenant to which a Delivery Service belongs is represented by a string that
is that Tenant's unique Name.

\paragraph{Topology}
The Topology used by a Delivery Service is represented by a string that is the
Topology's unique Name.

\paragraph{Vanity Hostnames}
"Vanity Hostnames" is a set of strings that are Fully Qualified Domain Names
(FQDN) which may be used as alternates to the standard
\code{\emph{Routing Name}.\emph{Name}.\emph{CDN Domain}} FQDN when requesting
content from the Delivery Service.\\
No two Delivery Services may be allowed to share any single Vanity Hostname.

\subsubsection{DNS-Routed Properties}

\paragraph{Bypass TTL}
An unsigned integer that defines the Time-To-Live (TTL) of DNS responses from
the Traffic Router for this Delivery Service's Bypass Destination, in seconds.

\paragraph{DNS TTL}
An unsigned integer that defines the Time-To-Live (TTL) of DNS responses from
the Traffic Router for this Delivery Service's routing, in seconds.

\paragraph{Max Records}

\subsubsection{HTTP-Routed Properties}

\paragraph{Additional Response Headers}

\paragraph{Consistent Hashing Regular Expression}

\paragraph{Logged Request Headers}

\paragraph{Significant Query Parameters}

\subsubsection{Steering-Routed Properties}

\paragraph{Targets}



\subsection{Infrastructure Servers}



\subsection{Origins}



\subsection{Profiles}
A Profile is a set of configuration options which may be associated with one or
more Cache Servers. It contains configuration options that are typically common
to a great number of Cache Servers within a CDN, and can therefore be changed
on an arbitrary number of Cache Servers simultaneously.

\subsubsection{Bandwidth Threshold}
The "Bandwidth Threshold" of a Cache Server is the maximum used bandwidth which
can be considered "healthy" for the Cache Server. It is suggested that clients
presenting controls to create/register a new Cache Server present the most
common value within the server's Cache Group as the default. Note that the value
may be zero, in which case the Cache Server will always be considered unhealthy
for the reason of exceeding this threshold.\\
If this value is null-typed, it has the meaning "no limit".

\subsubsection{Description}
Description is a human-readable string that ideally describes what the Profile
is for and to what servers it ought to be limited in its assignment.\\
This may be an empty string, but clients of the API are encouraged to promote
its sensible use as much as possible.

\subsubsection{Hard Disks}
A collection of Hard Disk Drives (HDDs)\footnote{This designation is meant to
contrast with "RAM Drives" where a block device maps to a section of main
memory. In practice, Hard Disks may be any block device, include Solid-State
Drives rather than actually HDDs.} available to the Cache Server for caching
content, represented as a set of file paths as strings to said devices. These
devices MUST be accessible for full read and write operations to the user as
whom the caching proxy software runs on the Cache Server.

\subsubsection{Health Polling Path}
This is a string that names a special request path recognized by the Cache
Server's caching proxy software which will result in the retrieval of statistics
rather than content. This MUST NOT be allowed to be an empty string. It MAY
contain a query string or even document fragment.\\
The only health-and-statistics-gathering implementation truly supported by ATC
is the special "astats" Traffic Server plugin.

\subsubsection{Loadavg Threshold}
A Cache Server's "Loadavg Threshold" is a floating-point number that represents
the one-minute "loadavg" above which the Cache Server will be considered
unhealthy. Note that it may be zero, in which case the Cache Server will always
be considered unhealthy for the reason of exceeding this threshold.\\
If this is null-typed, it has the special meaning "no limit".\\
For more information consult the
\href{https://linux.die.net/man/3/getloadavg}{\code{getloadavg(3)} manual page},
and/or the
\href{https://linux.die.net/man/5/proc}{\code{/proc(5)} manual page}.

\subsubsection{Name}
A Profile's Name is a string that uniquely identifies it among all Profiles.\\
It MUST NOT be empty and MUST only contain alphanumeric characters,
underscores, and hyphens.

\subsubsection{Parameters}
A Profile's principle job is to contain Parameters. Each Parameter represents
some arbitrary piece of configuration related to a Cache Server's operation.
These are mainly used by the configuration file generation process to help
create caching-proxy-server-implementation-specific configuration files, but in
practice may represent other miscellaneous configuration options.\\
Each Parameter is an object, the properties of which are herein described.

\paragraph{Configuration File}
A Parameter's Configuration File is a string that typically names the
configuration file to which configuration is added by this Parameter. This
is merely the \emph{name} of the file, and not its full \emph{file path}, for
example a configuration file for Apache Traffic Server that typically is placed
at \code{/etc/trafficserver/records.config} would be named in a Configuration
File property of a Parameter as simply \code{records.config}. The location of
the file on the Cache Server is implementation-specific, and the configuration
file generation system is responsible for knowing where that is.\\
This string MUST NOT be empty - even if it configures something that is not
contained within an actual configuration file it ought to have a Configuration
File value that describes what it configures.\\
The combination of a Parameter's Configuration File and its Name must be unique
among a Profile's Parameters.

\paragraph{Name}
The Name of a Parameter is a string describes the specific configuration option
that the Parameter configures. Typically this is the name of the configuration
field within a configuration file generated for the Cache Server(s) using this
Profile.\\
This string MUST NOT be empty.\\
The combination of a Parameter's Configuration File and its Name must be unique
among a Profile's Parameters.

\paragraph{Secure\label{sec:profile:param:secure}}
Secure is a boolean value which - if \code{true} - will cause its Value to be
obscured for users without the \code{secure-parameters} Permission, and such
users will be unable to edit the Parameter in any way - or even remove it from
the Profile (even if they have all other required Permissions). However, a
Profile can be replaced on a Cache Server even if it has Secure Parameters.

\paragraph{Value}
A Parameter's Value is a string, but it may be semantically interpreted by
configuration management systems in arbitrary ways. For this reason it is very
important that clients of the API ensure that users are empowered to enter
semantically correct values for Parameters based on whatever configuration
management system is in use, to the highest degree possible - because the API
can make no such guarantees and performs no such checks.\\
This string MUST NOT be empty.

\subsubsection{Query Time Threshold}
A Cache Server's "Query Time Threshold" is an unsigned integer number of
milliseconds after which a Traffic Monitor polling it for health will consider
it unhealthy, even if it successfully returns healthy metrics. Note that it may
be zero, in which case the Cache Server(s) using this Profile will always be
considered unhealthy for the reason of exceeding this threshold.\\
If this value is null-typed, it has the special meaning "no threshold"
(however, Traffic Monitor polling timeouts still apply).

\subsubsection{RAM Disks}
A collection of RAM Disk Drives available to the Cache Server for caching
content, represented as a set of file paths as strings to said devices. These
devices MUST be accessible for full read and write operations to the user as
whom the caching proxy software runs on the Cache Server.

\subsubsection{Tags}
The Tags associated with a Profile are represented by a set of strings that are
Tag Names.

\subsection{Physical Locations}



\subsection{Roles\label{sec:roles-and-perms}}
A Role controls what a User can and can't do through the API by declaring the
User's Permissions. The Permissions required by the different API endpoints,
request methods of endpoints, and particular modes of operations of the methods
of those endpoints are declared by the endpoints themselves.

\subsubsection{Description}
A Role's Description is a string containing a human-readable description of
what the Role is for and what, in general terms, it is capable of accomplishing
through the API.\\
This may be an empty string, but clients of the API are encouraged to attempt
to promote the idea of useful descriptions as much as possible, to avoid
creating a clutter of Roles that no one understands and/or a swathe of Roles
which no one can determine are safe to delete.

\subsubsection{Name}
A Role's Name is a string that uniquely identifies it - and as such MUST NOT be
empty - and may only contain alphanumeric characters, spaces, and periods.

\subsubsection{Permissions}
The Permissions allowed to a Role are represented as a set of strings which are
the Permission's names.\\
The Permissions that exist - and therefore may be on a Role - are a finite set
and if it is attempted to add a Permission which does not exist to a Role,
the attempt will result in an error from Traffic Ops, and will not be
successful. This set of available Permissions is defined by the Permissions
each individual endpoint declares are required for part or all of their
operation, and therefore cannot (and should not) be enumerated
here\footnote{As a special case, the \ref{sec:profile:param:secure} section of
the Data Model describes a Permission that will always exist for as long as
that property of a Profile's Parameter(s) exists.}.

\subsection{Tags}
Tags may be used to group "taggable" objects for logical or administrative
purposes.\\
While plug-ins and other third-party code such as custom configuration
management systems may glean some semantic meaning from a Tag's Name or
presence on an object, Traffic Control components - \emph{including Traffic Ops
and its API} - MUST NOT infer any special meaning from any Tag's Name or
presence on an object, nor attach any semantic value to a Tag's presence on an
object, a Tag's Name, or any pattern of Tag Name.\\
What is known as a "taggable" object is simply any object with a "Tags"
property that contains a set of Tag Names which are the tags associated with
said object. Thus, any object types added to the API at any point in the future
may be "taggable", but for the data model herein outlined the following objects
those that are "taggable":

\begin{itemize}
	\item Cache Groups
	\item Cache Servers
	\item Delivery Services
	\item Infrastructure Servers
	\item Origins
	\item Physical Locations
	\item Profiles
	\item Tenants
	\item Topologies
	\item Users
\end{itemize}

\subsubsection{Name}
Name is the only property of a Tag, and is therefore a unique identifier for
a Tag. It is a string that ought to give some indication of what the Tag is for
but ultimately any meaning for the Tag is left to system administrators to
define and maintain.\\
This string MUST NOT be empty and MUST only contain alphanumeric characters.

\subsection{Tenants}


\subsection{Topologies}


\subsection{Traffic Monitors}
A Traffic Monitor is a service that communicates with Traffic Ops over HTTP and
is responsible for collecting health and statistics information from Cache
Servers to determine if they are fit to service content.

\subsubsection{CDN}
The CDN to which a Traffic Monitor belongs is represented by its Name, which
uniquely identifies it. The Monitor will monitor all Cache Servers that are in
its CDN.

\subsubsection{Config Polling Interval}
Config Polling Interval is an unsigned integer that defines an interval - in
milliseconds - on which the Monitor should poll Traffic Ops for its
configuration changes. This MUST NOT be \code{0}.

\subsubsection{Domain}
This is the "domain" part of the Traffic Monitor's Fully Qualified Domain Name
(FQDN) as a string. For example, a Traffic Monitor with an FQDN of
\code{github.com} has a Domain of \code{com} and a Traffic Monitor with an FQDN
of \code{trafficcontrol.apache.org} has a Domain of \code{apache.org}.

\subsubsection{Event Count}
This unsigned integer defines the number of "events" of which the Monitor will
keep track internally.\\
The value \code{0} means "no limit".

\subsubsection{Health Polling Interval}
This unsigned integer defines an interval - in milliseconds - on which to poll
Cache Server health. This MUST NOT be \code{0}.

\subsubsection{Heartbeat Polling Interval}
This unsigned integer defines an interval - in milliseconds - on which to poll
Cache Server "heartbeats". This poll is not meant to determine health, but
rather whether or not the Cache Server(s) may be reached over the network at
all. This MUST NOT be \code{0}.

\subsubsection{Host Name}
This is the "host" part of the Traffic Monitor's Fully Qualified Domain Name
(FQDN) as a string. For example, a Traffic Monitor with an FQDN of
\code{github.com} has a Host Name of \code{github}, and a Traffic Monitor with an
FQDN of \code{trafficcontrol.apache.org} has a Host Name of
\code{trafficcontrol}.\\
This field does NOT need to be unique, though operators are encouraged to make
this - or at least the concatenation \code{\emph{Host Name}.{Domain}} - unique
for ease of operation.

\subsubsection{ID}
A Traffic Monitor's "ID" is an unsigned integer that uniquely identifies it
among all Traffic Monitors. It serves no purpose beyond unique identification of
the Traffic Monitor.

\subsubsection{Notes}
This section is an arbitrary string containing miscellaneous, human-friendly
information about the Traffic Monitor. Other ATC components SHOULD NOT parse
this for specific information fields, or expect it to be in a particular
format.

\subsubsection{Physical Location}
The Physical Location at which a Traffic Monitor resides is represented by a
string containing its Name.

\subsubsection{Tags}
A Traffic Monitor's "Tags" are represented as a set of Tag Names.

\subsubsection{Thread Count}
Thread Count is an unsigned integer that determines the number of threads used
to concurrently poll Cache Servers. It is recommended that UIs built on the
Traffic Ops API set this to \code{0} by default and caution users against
changing it. The value \code{0} will cause Traffic Monitor to choose a value
for itself\footnote{A recommendation for Traffic Monitor engineers: a
reasonable default value would be the number of available CPU cores.}.

\subsubsection{Time Pad}
This is an unsigned integer that defines a set number of milliseconds to add
to request timers to help spread requests out for Traffic Control systems that
use a large number of Traffic Monitors.

\subsection{Traffic Portals}



\subsection{Traffic Routers}

\subsubsection{CDN}
The CDN to which a Cache Server belongs is represented by its Name, which
uniquely identifies it.

\subsubsection{Domain}
This is the "domain" part of the Cache Server's Fully Qualified Domain Name
(FQDN) as a string. For example, a Cache Server with an FQDN of
\code{github.com} has a Domain of \code{com} and a Cache Server with an FQDN of
\code{trafficcontrol.apache.org} has a Domain of \code{apache.org}.

\subsubsection{Host Name}
This is the "host" part of the Cache Server's Fully Qualified Domain Name (FQDN)
as a string. For example, a Cache Server with an FQDN of \code{github.com} has a
Host Name of \code{github}, and a Cache Server with an FQDN of
\code{trafficcontrol.apache.org} has a Host Name of \code{trafficcontrol}.\\
This field does NOT need to be unique, though operators are encouraged to make
this - or at least the concatenation \code{\emph{Host Name}.{Domain}} - unique
for ease of operation.

\subsubsection{ID}
A Cache Server's "ID" is an unsigned integer that uniquely identifies it among
all Cache Servers. It serves no purpose beyond unique identification of the
Cache Server.

\subsubsection{Notes}
This section is an arbitrary string containing miscellaneous, human-friendly
information about the Cache Server. Other ATC components SHOULD NOT parse this
for specific information fields, or expect it to be in a particular format.

\subsubsection{Physical Location}
The Physical Location at which a Cache Server resides is represented by a string
containing its Name.

\subsubsection{Tags}
A Cache Server's "Tags" are represented as a set of Tag Names.


\subsection{Traffic Stats Servers}



\subsection{Traffic Vaults}



\subsection{Users\label{sec:users}}
A user represents a person who may be authenticated with the Traffic Ops API and
their ability to interact with Traffic Ops Data Model objects. A User object
also contains "meta" information such as their email address.

\subsubsection{Address}
This is a text field with no defined structure, but semantically it represents a
user's real-world, physical address. If it is not an empty value, it is assumed
to contain enough information to send a letter through normal postage to the
user.\\
Addresses may consist of alphanumeric characters, hyphens, periods, spaces, and
newlines, but may not end with a space or newline.

\subsubsection{Email}
A user's email address, which is used for initial registration and password
recovery. A User object is not guaranteed to have an Email because the initial,
default User will not have one. However, UIs based on the Traffic Ops API are
encouraged to require that new users have one, as otherwise they will be unable
to recover their account if their password is forgotten.\\
Emails are unique among all Users, unless they are "Null"-valued.\\
Representation formats that do not support email addresses natively as a type
MUST represent this a string.

\subsubsection{Full Name}
A user's "full" name, as it would appear on a letter mailed to them, as a
string. This field, if not empty, is presumed to be the user's name as it would
appear on normal postage. This field MUST NOT be allowed to contain
non-alphabetic characters.

\subsubsection{Phone Number}
A string which, if not empty, is presumed to be a telephone number at which the
user may be contacted. It MUST only be allowed to contain numerics and hyphens,
and must neither start nor end with a hyphen.

\subsubsection{Role}
A user's permissions are encapsulated by their Role, which is represented as a
map containing two keys, "name" that maps to the Role's Name as a string and
"permissions" which maps to a set of Permission Names as strings.

\subsubsection{Tenant}
The scope of a user's permissions is expressed as a string that is the Name of
the Tenant to which the user belongs.

\subsubsection{Username}
A user's "Username" is a string that is used to uniquely identify them among all
Users. It is only allowed to contain alphanumeric characters.
