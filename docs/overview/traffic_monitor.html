


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Traffic Monitor &mdash; Traffic Control 3.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Traffic Ops" href="traffic_ops.html" />
    <link rel="prev" title="Profiles and Parameters" href="profiles_and_parameters.html" />
    <link href="../_static/theme_overrides.css" rel="stylesheet" type="text/css"/>


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Traffic Control
          

          
            
            <img src="../_static/ATC-SVG-FULL-WHITE.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">CDN Basics</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Traffic Control Overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="delivery_services.html">Delivery Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiles_and_parameters.html">Profiles and Parameters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Traffic Monitor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cache-monitoring">Cache Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="#health-protocol">Health Protocol</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops.html">Traffic Ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_portal.html">Traffic Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_router.html">Traffic Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_stats.html">Traffic Stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_vault.html">Traffic Vault</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin/index.html">Administrator’s Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Developer’s Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Traffic Ops API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Traffic Control</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Traffic Control Overview</a> &raquo;</li>
        
      <li>Traffic Monitor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/overview/traffic_monitor.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="traffic-monitor">
<span id="tm-overview"></span><h1>Traffic Monitor<a class="headerlink" href="#traffic-monitor" title="Permalink to this headline">¶</a></h1>
<p>Traffic Monitor is an HTTP service that monitors the <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a>s in a CDN for a variety of metrics. These metrics are for use in determining the overall “health” of a given <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> and the related <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a>s. A given CDN can operate a number of Traffic Monitors, from a number of geographically diverse locations, to prevent false positives caused by network problems at a given site. Traffic Monitors operate independently, but use the state of other Traffic Monitors in conjunction with their own state to provide a consistent view of CDN <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> health to upstream applications such as <a class="reference internal" href="traffic_router.html#tr-overview"><span class="std std-ref">Traffic Router</span></a>. <a class="reference internal" href="#health-protocol">Health Protocol</a> governs the <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> and <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a> availability. Traffic Monitor provides a view into CDN health using several RESTful JSON endpoints, which are consumed by other Traffic Monitors and upstream components such as <a class="reference internal" href="traffic_router.html#tr-overview"><span class="std std-ref">Traffic Router</span></a>. Traffic Monitor is also responsible for serving the overall CDN configuration to <a class="reference internal" href="traffic_router.html#tr-overview"><span class="std std-ref">Traffic Router</span></a>, which ensures that the configuration of these two critical components remain synchronized as operational and health related changes propagate through the CDN.</p>
<div class="section" id="cache-monitoring">
<span id="astats"></span><h2>Cache Monitoring<a class="headerlink" href="#cache-monitoring" title="Permalink to this headline">¶</a></h2>
<p>Traffic Monitor polls all <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a>s configured with a status of <code class="docutils literal notranslate"><span class="pre">REPORTED</span></code> or <code class="docutils literal notranslate"><span class="pre">ADMIN_DOWN</span></code> at an interval specified as a configuration parameter in <a class="reference internal" href="traffic_ops.html#to-overview"><span class="std std-ref">Traffic Ops</span></a>. If the <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> is set to <code class="docutils literal notranslate"><span class="pre">ADMIN_DOWN</span></code> it is marked as unavailable but still polled for availability and statistics. If the <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> is explicitly configured with a status of <code class="docutils literal notranslate"><span class="pre">ONLINE</span></code> or <code class="docutils literal notranslate"><span class="pre">OFFLINE</span></code>, it is not polled by Traffic Monitor and presented to <a class="reference internal" href="traffic_router.html#tr-overview"><span class="std std-ref">Traffic Router</span></a> as configured, regardless of actual availability. Traffic Monitor makes HTTP requests at regular intervals to a special URL on each Edge-tier <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> and consumes the JSON output. The special URL is served by a plugin running on the <abbr title="Apache Traffic Server">ATS</abbr> <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a>s called <a class="reference external" href="https://github.com/apache/trafficcontrol/tree/master/traffic_server/plugins/astats_over_http">“astats”</a>, which is restricted to Traffic Monitor only. The astats plugin provides insight into application and system performance, such as:</p>
<ul class="simple">
<li><p>Throughput (e.g. bytes in, bytes out, etc).</p></li>
<li><p>Transactions (e.g. number of 2xx, 3xx, 4xx responses, etc).</p></li>
<li><p>Connections (e.g. from clients, to parents, origins, etc).</p></li>
<li><p>Cache performance (e.g.: hits, misses, refreshes, etc).</p></li>
<li><p>Storage performance (e.g.: writes, reads, frags, directories, etc).</p></li>
<li><p>System performance (e.g: load average, network interface throughput, etc).</p></li>
</ul>
<p>Many of the application-level statistics are available at the global or aggregate level, some at the <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a> level. Traffic Monitor uses the system-level performance to determine the overall health of the <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> by evaluating network throughput and load against values configured in <a class="reference internal" href="traffic_ops.html#to-overview"><span class="std std-ref">Traffic Ops</span></a>. Traffic Monitor also uses throughput and transaction statistics at the <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a> level to determine <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a> health. If astats is unavailable due to a network-related issue or the system statistics have exceeded the configured thresholds, Traffic Monitor will mark the <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> as unavailable. If the <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a>statistics exceed the configured thresholds, the <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a> is marked as unavailable, and <a class="reference internal" href="traffic_router.html#tr-overview"><span class="std std-ref">Traffic Router</span></a> will start sending clients to the overflow destinations for that <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a>, but the <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> remains available to serve other content,</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For more information on <abbr title="Apache Traffic Server">ATS</abbr> statistics, see the <a class="reference external" href="https://docs.trafficserver.apache.org/en/7.1.x/index.html">ATS documentation</a></p>
</div>
</div>
<div class="section" id="health-protocol">
<span id="health-proto"></span><h2>Health Protocol<a class="headerlink" href="#health-protocol" title="Permalink to this headline">¶</a></h2>
<p>Redundant Traffic Monitor servers operate independently from each other but take the state of other Traffic Monitors into account when asked for health state information. In <a class="reference internal" href="#cache-monitoring">Cache Monitoring</a>, the behavior of a single Traffic Monitor instance is described. The <em class="dfn">Health Protocol</em> adds another dimension to the health state of the CDN by merging the states of all Traffic Monitors into one, and then taking the <em>optimistic</em> approach when dealing with a <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> or <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a> that might have been marked as unavailable by this particular instance or a peer instance of Traffic Monitor. Upon startup or configuration change in <a class="reference internal" href="traffic_ops.html#to-overview"><span class="std std-ref">Traffic Ops</span></a>, in addition to <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a>s, Traffic Monitor begins polling its peer Traffic Monitors whose state is set to <code class="docutils literal notranslate"><span class="pre">ONLINE</span></code>. Each <code class="docutils literal notranslate"><span class="pre">ONLINE</span></code> Traffic Monitor polls all of its peers at a configurable interval and saves the peer’s state for later use. When polling its peers, Traffic Monitor asks for the raw health state from each respective peer, which is strictly that instance’s view of the CDN’s health. When any <code class="docutils literal notranslate"><span class="pre">ONLINE</span></code> Traffic Monitor is asked for CDN health by an upstream component, such as <a class="reference internal" href="traffic_router.html#tr-overview"><span class="std std-ref">Traffic Router</span></a>, the component gets the Health Protocol-influenced version of CDN health (non-raw view). In operation of the Health Protocol, Traffic Monitor takes all health states from all peers, including the locally known health state, and serves an optimistic outlook to the requesting client. This means that, for example, if three of the four Traffic Monitors see a given <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> or <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a> as exceeding its thresholds and unavailable, it is still considered available. Only if all Traffic Monitors agree that the given object is unavailable is that state propagated to upstream components. This optimistic approach to the Health Protocol is counter to the “fail fast” philosophy, but serves well for large networks with complicated geography and or routing. The optimistic Health Protocol allows network failures or latency to occur without affecting overall traffic routing, as Traffic Monitors can and do have a different view of the network when deployed in geographically diverse locations. Short polling intervals of both the <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a>s and Traffic Monitor peers help to reduce customer impact of outages. It is not uncommon for a <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> to be marked unavailable by Traffic Monitor - in fact, it is business as usual for many CDNs. Should a widely requested video asset cause a single <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> to get close to its interface capacity, the Health Protocol will “kick in”, and Traffic Monitor marks the <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> as unavailable. New clients want to see the same asset, and now <a class="reference internal" href="traffic_router.html#tr-overview"><span class="std std-ref">Traffic Router</span></a> will send these customers to another <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a> in the same <a class="reference internal" href="../glossary.html#term-cache-group"><span class="xref std std-term">Cache Group</span></a>. The load is now shared between the two <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a>s. As clients finish watching the asset on the overloaded <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a>, it will drop below the threshold and gets marked available again, and new clients will begin to be directed to it once more. It is less common for a <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a> to be marked unavailable by Traffic Monitor, the <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a> thresholds are usually used for overflow situations at extreme peaks to protect other <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a>s in the CDN from being impacted.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="traffic_ops.html" class="btn btn-neutral float-right" title="Traffic Ops" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="profiles_and_parameters.html" class="btn btn-neutral" title="Profiles and Parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Traffic Control

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>