


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Traffic Ops &mdash; Traffic Control 3.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Traffic Ops - Go" href="traffic_ops_golang.html" />
    <link rel="prev" title="Building Traffic Control" href="building.html" />
    <link href="../_static/theme_overrides.css" rel="stylesheet" type="text/css"/>


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Traffic Control
          

          
            
            <img src="../_static/ATC-SVG-FULL-WHITE.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">CDN Basics</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Traffic Control Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin/index.html">Administrator’s Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="building.html">Building Traffic Control</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Traffic Ops</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#software-requirements">Software Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#traffic-ops-project-tree-overview">Traffic Ops Project Tree Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#perl-formatting-conventions">Perl Formatting Conventions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#app-db-admin">app/db/admin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#options-and-arguments">Options and Arguments</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installing-the-developer-environment">Installing The Developer Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-cases">Test Cases</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-kabletown-cdn-example">The KableTown CDN example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#extensions">Extensions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#extensions-at-runtime">Extensions at Runtime</a></li>
<li class="toctree-l4"><a class="reference internal" href="#trafficopsroutes-pm"><code class="docutils literal notranslate"><span class="pre">TrafficOpsRoutes.pm</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#development-configuration">Development Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops_golang.html">Traffic Ops - Go</a></li>
<li class="toctree-l2"><a class="reference internal" href="ort/traffic_ops_ort.html">traffic_ops_ort package</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_portal.html">Traffic Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_router.html">Traffic Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_monitor.html">Traffic Monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_stats.html">Traffic Stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation_guidelines.html">Documentation Guidelines</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Traffic Ops API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Traffic Control</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer’s Guide</a> &raquo;</li>
        
      <li>Traffic Ops</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/development/traffic_ops.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="traffic-ops">
<h1>Traffic Ops<a class="headerlink" href="#traffic-ops" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Traffic Ops uses a PostgreSQL database to store the configuration information, and the <a class="reference external" href="http://mojolicio.us/">Mojolicious framework</a> to generate the user interface and REST APIs.</p>
</div>
<div class="section" id="software-requirements">
<h2>Software Requirements<a class="headerlink" href="#software-requirements" title="Permalink to this headline">¶</a></h2>
<p>To work on Traffic Ops you need a CentOS 7+ environment that has the following installed:</p>
<ul>
<li><p><a class="reference external" href="http://search.cpan.org/~miyagawa/Carton-v1.0.12/lib/Carton.pm">Carton 1.0.12</a></p>
<blockquote>
<div><ul class="simple">
<li><p>libpcap (plus development library - usually “libpcap-dev” or “libpcap-devel”)</p></li>
<li><p>libpq (plus development library - usually “libpq-dev” or “libpq-devel”)</p></li>
<li><p>cpan JSON</p></li>
<li><p>cpan JSON::PP</p></li>
</ul>
</div></blockquote>
</li>
<li><p><a class="reference external" href="http://golang.org/doc/install">Go 1.8.3</a></p></li>
<li><p>Perl 5.10.1</p></li>
<li><p>Git</p></li>
<li><p>PostgreSQL 9.6.6</p></li>
<li><p><a class="reference external" href="https://bitbucket.org/liamstask/goose/">Goose</a></p></li>
</ul>
</div>
<div class="section" id="traffic-ops-project-tree-overview">
<h2>Traffic Ops Project Tree Overview<a class="headerlink" href="#traffic-ops-project-tree-overview" title="Permalink to this headline">¶</a></h2>
<p>traffic_ops/ - The root of the Traffic Ops project</p>
<blockquote>
<div><ul>
<li><p>app/ - Holds most of the Perl code base</p>
<blockquote>
<div><ul>
<li><p>bin/ - Directory for scripts, <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/cron(8)">cron(8)</a></em> jobs, etc</p></li>
<li><p>conf/</p>
<blockquote>
<div><ul class="simple">
<li><p>development/ - Development (local) specific configuration files.</p></li>
<li><p>misc/ - Miscellaneous configuration files.</p></li>
<li><p>production/ - Production specific configuration files.</p></li>
<li><p>test/ - Test (unit test) specific configuration files.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>db/ - Database related area.</p>
<blockquote>
<div><ul class="simple">
<li><p>migrations/ - Database Migration files.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>lib/</p>
<blockquote>
<div><ul>
<li><p>API/ - Mojolicious Controllers for the <a class="reference internal" href="../api/index.html#to-api"><span class="std std-ref">Traffic Ops API</span></a></p></li>
<li><p>Common/ - Common Code between both the <a class="reference internal" href="../api/index.html#to-api"><span class="std std-ref">Traffic Ops API</span></a> and the deprecated Traffic Ops UI</p></li>
<li><p>Extensions/ - Contains <a class="reference internal" href="../admin/traffic_ops/extensions.html#to-datasource-ext"><span class="std std-ref">Data Source Extensions</span></a></p></li>
<li><p>Fixtures/ - Test Case fixture data for the ‘to_test’ database.</p>
<blockquote>
<div><ul class="simple">
<li><p>Integration/ - Integration Tests.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>MojoPlugins/ - Mojolicious Plugins for Common Controller Code.</p></li>
<li><p>Schema/ - Database Schema area.</p>
<blockquote>
<div><ul class="simple">
<li><p>/Result - DBIx ORM related files.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>/Test - Common Test.</p></li>
<li><p>UI/ - Mojolicious Controllers for the deprecated Traffic Ops UI.</p></li>
<li><p>Utils/</p>
<blockquote>
<div><ul class="simple">
<li><p>Helper/ - Common utilities for the Traffic Ops application.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>log/ - Log directory where the development and test files are written</p></li>
<li><p>public/</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>css/ - Stylesheets</p></li>
<li><p>images/ - Images</p></li>
<li><p>js/ - Javascripts</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>script/ - Mojolicious Bootstrap scripts.</p></li>
<li><p>t/ - Unit Tests for the UI.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>api/ - Unit Tests for the API.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>t_integration/ - High level tests for Integration level testing.</p></li>
<li><p>templates/ - Mojolicious Embedded Perl (<code class="docutils literal notranslate"><span class="pre">*.ep</span></code>) files for the UI.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>bin/ - holds executables related to Traffic Ops, but not actually a part of the Traffic Ops server’s operation</p></li>
<li><p>build/ - contains files that are responsible for packaging Traffic Ops into an RPM file</p></li>
<li><p>client/ - API endpoints handled by Go</p></li>
<li><p>client_tests/ - lol</p></li>
<li><p>doc/ - contains only a <code class="file docutils literal notranslate"><span class="pre">coverage-zone.json</span></code> example (?) file</p></li>
<li><p>etc/ - configuration files needed for the Traffic Ops server</p>
<blockquote>
<div><ul class="simple">
<li><p>cron.d/ - holds specifications for <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/cron(8)">cron(8)</a></em> jobs that need to be run periodically on Traffic Ops servers</p></li>
<li><p>init.d/ - contains the old initscripts-based job control for Traffic Ops</p></li>
<li><p>logrotate.d/ - specifications for the Linux <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/logrotate(8)">logrotate(8)</a></em> utility for Traffic Ops log files</p></li>
<li><p>profile.d/traffic_ops.sh - sets up common environment variables for working with Traffic Ops</p></li>
</ul>
</div></blockquote>
</li>
<li><p>experimental/ - includes all kinds of prototype and/or abandoned tools and extensions</p>
<blockquote>
<div><ul class="simple">
<li><p>ats_config/ - an attempt to provide an easier method of obtaining and/or writing configuration files for <abbr title="Apache Traffic Server">ATS</abbr> <a class="reference internal" href="../glossary.html#term-cache-server"><span class="xref std std-term">cache server</span></a>s</p></li>
<li><p>auth/ - a simple authentication server that mimics the authentication process of Traffic Ops, and provides a detailed view of a logged-in user’s permissions and capabilities</p></li>
<li><p>goto/ - an Angular (1.x) web page backed by a Go server that provides a ReST API interface for mySQL servers</p></li>
<li><p>postgrest/ - originally probably going to be a web server that provides a ReST API for postgreSQL servers, this only contains a simple - albeit unfinished - Docker container specification for running postgreSQL client tools and/or server(s)</p></li>
<li><p>server/ - a living copy of the original attempt at re-writing Traffic Ops in Go</p></li>
<li><p>traffic_ops_auth/ - proof-of-concept for authenticating, creating and deleting users in a Traffic Ops schema.</p></li>
<li><p>url-rewriter-nginx/ - Docker container specification for a modification to the NginX web server, meant to make it suitable for use as a caching server at the Edge-tier or Mid-tier levels of the Traffic Control architecture</p></li>
<li><p>webfront/ - a simple HTTP caching server written from the ground-up, meant to be suitable as a caching server at the Edge-tier or Mid-tier levels of the Traffic Control architecture</p></li>
</ul>
</div></blockquote>
</li>
<li><p>install/ - contains all of the resources necessary for a full install of Traffic Ops</p>
<blockquote>
<div><ul class="simple">
<li><p>bin/ - binaries related to installing Traffic Ops, as well as installing its prerequisites, certificates, and database</p></li>
<li><p>data/ - almost nothing</p></li>
<li><p>etc/ - this directory left empty; it’s used to contain post-installation extensions and resources</p></li>
<li><p>lib/ - contains libraries used by the various installation binaries</p></li>
</ul>
</div></blockquote>
</li>
<li><p>testing/ - holds utilities for testing the <a class="reference internal" href="../api/index.html#to-api"><span class="std std-ref">Traffic Ops API</span></a>, as well as comparing two separate API instances (for e.g. comparing a new build to a known-to-work build)</p></li>
<li><p>traffic_ops_golang/ - has all of the functionality that has been re-written from Perl into Go</p></li>
<li><p>vendor/ - contains “vendored” packages from third party sources</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="perl-formatting-conventions">
<h2>Perl Formatting Conventions<a class="headerlink" href="#perl-formatting-conventions" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://perltidy.sourceforge.net/">Perltidy</a> is for use in code formatting.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-number">#79 </span><span class="caption-text">Example Perltidy Configuration (usually in <code class="file docutils literal notranslate"><span class="pre">~/.perltidyrc</span></code>)</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-l=156
-et=4
-t
-ci=4
-st
-se
-vt=0
-cti=0
-pt=1
-bt=1
-sbt=1
-bbt=1
-nsfs
-nolq
-otr
-aws
-wls=&quot;= + - / * .&quot;
-wrs=\&quot;= + - / * .\&quot;
-wbb=&quot;% + - * / x != == &gt;= &lt;= =~ &lt; &gt; | &amp; **= += *= &amp;= &lt;&lt;= &amp;&amp;= -= /= |= + &gt;&gt;= ||= .= %= ^= x=&quot;
</pre></div>
</div>
</div>
</div>
<div class="section" id="app-db-admin">
<span id="database-management"></span><h2>app/db/admin<a class="headerlink" href="#app-db-admin" title="Permalink to this headline">¶</a></h2>
<p>The <strong class="program">app/db/admin</strong> binary is for use in managing the Traffic Ops database tables. This essentially serves as a front-end for <a class="reference external" href="https://bitbucket.org/liamstask/goose/">Goose</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For proper resolution of configuration and SOL statement files, it’s recommended that this binary be run from the <code class="docutils literal notranslate"><span class="pre">app</span></code> directory</p>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">db/admin</span> <span class="pre">[options]</span> <span class="pre">command</span></code></p>
</div>
<div class="section" id="options-and-arguments">
<h3>Options and Arguments<a class="headerlink" href="#options-and-arguments" title="Permalink to this headline">¶</a></h3>
<dl class="option">
<dt id="cmdoption-admin-env">
<code class="sig-name descname">--env</code><code class="sig-prename descclassname"> ENVIRONMENT</code><a class="headerlink" href="#cmdoption-admin-env" title="Permalink to this definition">¶</a></dt>
<dd><p>An optional environment specification that causes the database configuration to be read out of the corresponding section of the <code class="file docutils literal notranslate"><span class="pre">app/db/dbconf.yml</span></code> configuration file. One of:</p>
<ul class="simple">
<li><p>development</p></li>
<li><p>integration</p></li>
<li><p>production</p></li>
<li><p>test</p></li>
</ul>
<p>(Default: <code class="docutils literal notranslate"><span class="pre">development</span></code>)</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-MOJO_MODE">
<code class="sig-name descname">MOJO_MODE</code><a class="headerlink" href="#envvar-MOJO_MODE" title="Permalink to this definition">¶</a></dt>
<dd><p><strong class="program">admin</strong> sets this to the value of the environment as specified by <a class="reference internal" href="#cmdoption-admin-env"><code class="xref std std-option docutils literal notranslate"><span class="pre">--env</span></code></a> (Default: <code class="docutils literal notranslate"><span class="pre">development</span></code>)</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-admin-arg-command">
<code class="sig-name descname">command</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-admin-arg-command" title="Permalink to this definition">¶</a></dt>
<dd><p>The :option;`command` specifies the operation to be performed on the database. It must be one of:</p>
<dl class="simple">
<dt>createdb</dt><dd><p>Creates the database for the current environment</p>
</dd>
<dt>create_user</dt><dd><p>Creates the user defined for the current environment</p>
</dd>
<dt>dbversion</dt><dd><p>Displays the database version that results from the current sequence of migrations</p>
</dd>
<dt>down</dt><dd><p>Rolls back a single migration from the current version</p>
</dd>
<dt>drop</dt><dd><p>Drops the database for the current environment</p>
</dd>
<dt>drop_user</dt><dd><p>Drops the user defined for the current environment</p>
</dd>
<dt>load_schema</dt><dd><p>Sets up the database for the current environment according to the SQL statements in <code class="docutils literal notranslate"><span class="pre">app/db/create_tables.sql</span></code></p>
</dd>
<dt>migrate</dt><dd><p>Runs a migration on the database for the current environment</p>
</dd>
<dt>patch</dt><dd><p>Patches the database for the current environment using the SQL statements from the <code class="docutils literal notranslate"><span class="pre">app/db/patches.sql</span></code></p>
</dd>
<dt>redo</dt><dd><p>Rolls back the most recently applied migration, then run it again</p>
</dd>
<dt>reset</dt><dd><p>Creates the user defined for the current environment, drops the database for the current environment, creates a new one, loads the schema into it, and runs a single migration on it</p>
</dd>
<dt>reverse_schema</dt><dd><p>Reverse engineers the <code class="docutils literal notranslate"><span class="pre">app/lib/Schema/Result/*</span></code> files from the environment database</p>
</dd>
<dt>seed</dt><dd><p>Executes the SQL statements from the <code class="docutils literal notranslate"><span class="pre">app/db/seeds.sql</span></code> file for loading static data</p>
</dd>
<dt>show_users</dt><dd><p>Displays a list of all users registered with the PostgreSQL server</p>
</dd>
<dt>status</dt><dd><p>Prints the status of all migrations</p>
</dd>
<dt>upgrade</dt><dd><p>Performs a migration on the database for the current environment, then seeds it and patches it using the SQL statements from the <code class="docutils literal notranslate"><span class="pre">app/db/patches.sql</span></code> file</p>
</dd>
</dl>
</dd></dl>

<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-number">#80 </span><span class="caption-text">Example Usage</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>db/admin --env<span class="o">=</span><span class="nb">test</span> reset
</pre></div>
</div>
</div>
<p>The environments are defined in the <code class="file docutils literal notranslate"><span class="pre">app/db/dbconf.yml</span></code> file, and the name of the database generated will be the name of the environment for which it was created.</p>
</div>
</div>
<div class="section" id="installing-the-developer-environment">
<h2>Installing The Developer Environment<a class="headerlink" href="#installing-the-developer-environment" title="Permalink to this headline">¶</a></h2>
<p>To install the Traffic Ops Developer environment:</p>
<ol class="arabic">
<li><p>Clone the <a class="reference external" href="https://github.com/apache/trafficcontrol">Traffic Control repository</a> from GitHub.</p></li>
<li><p>Install the local dependencies using <a class="reference external" href="https://metacpan.org/release/Carton">Carton</a>.</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-number">#81 </span><span class="caption-text">Install Development Dependencies</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> traffic_ops/app
carton
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>Set up a role (user) in PostgreSQL</p>
<blockquote>
<div><div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://wiki.postgresql.org/wiki/First_steps">PostgreSQL instructions on setting up a database</a>.</p>
</div>
</div></blockquote>
</li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">reset</span></code> and <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> <a class="reference internal" href="#cmdoption-admin-arg-command"><code class="xref std std-option docutils literal notranslate"><span class="pre">command</span></code></a>s of <strong class="program">admin</strong> (see <a class="reference internal" href="#database-management"><span class="std std-ref">app/db/admin</span></a> for usage) to set up the <code class="docutils literal notranslate"><span class="pre">traffic_ops</span></code> database(s).</p></li>
<li><p>(Optional) To load the ‘KableTown’ example/testing data set into the tables, use the <code class="file docutils literal notranslate"><span class="pre">app/bin/db/setup_kabletown.pl</span></code> script.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>To ensure proper paths to Perl libraries and resource files, <code class="docutils literal notranslate"><span class="pre">setup_kabletown.pl</span></code> should be run from within the <code class="docutils literal notranslate"><span class="pre">app/</span></code> directory.</p>
</div>
</div></blockquote>
</li>
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">postinstall</span></code> script, located in <code class="docutils literal notranslate"><span class="pre">install/bin/</span></code></p></li>
<li><p>To start Traffic Ops, use the <code class="docutils literal notranslate"><span class="pre">start.pl</span></code> script located in the <code class="docutils literal notranslate"><span class="pre">app/bin</span></code> directory. If the server starts successfully, the STDOUT of the process should contain the line <code class="docutils literal notranslate"><span class="pre">[&lt;date</span> <span class="pre">and</span> <span class="pre">time&gt;]</span> <span class="pre">[INFO]</span> <span class="pre">Listening</span> <span class="pre">at</span> <span class="pre">&quot;http://*:3000&quot;</span></code>, followed by the line <code class="docutils literal notranslate"><span class="pre">Server</span> <span class="pre">available</span> <span class="pre">at</span> <span class="pre">http://127.0.0.1:3000</span></code> (using default settings for port number and listening address, and where <code class="docutils literal notranslate"><span class="pre">&lt;date</span> <span class="pre">and</span> <span class="pre">time&gt;</span></code> is an actual date and time in ISO format).</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>To ensure proper paths to Perl libraries and resource files, the <code class="docutils literal notranslate"><span class="pre">start.pl</span></code> script should be run from within the <code class="docutils literal notranslate"><span class="pre">app/</span></code> directory.</p>
</div>
</div></blockquote>
</li>
<li><p>Using a web browser, navigate to the given address: <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:3000</span></code></p></li>
<li><p>A prompt for login credentials should appear. Assuming default settings are used, the initial login credentials will be</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">User name</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">admin</span></code></p>
</dd>
<dt class="field-even">Password</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">password</span></code></p>
</dd>
</dl>
</div></blockquote>
</li>
<li><p>Change the login credentials.</p>
<blockquote>
<div><div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../admin/traffic_ops/using.html#to-using"><span class="std std-ref">Traffic Ops - Using</span></a></p>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="test-cases">
<h2>Test Cases<a class="headerlink" href="#test-cases" title="Permalink to this headline">¶</a></h2>
<p>Use <a class="reference external" href="http://perldoc.perl.org/prove.html">prove</a> (should be installed with Perl) to execute test cases. Execute after a <code class="docutils literal notranslate"><span class="pre">carton</span> <span class="pre">install</span></code> of all required dependencies:</p>
<ul class="simple">
<li><p>To run the Unit Tests: <code class="docutils literal notranslate"><span class="pre">prove</span> <span class="pre">-qrp</span>&#160; <span class="pre">app/t/</span></code></p></li>
<li><p>To run the Integration Tests: <code class="docutils literal notranslate"><span class="pre">prove</span> <span class="pre">-qrp</span> <span class="pre">app/t_integration/</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As progress continues on moving Traffic Ops to run entirely in Go, the number of passing tests has steadily decreased. This means that the tests are not a reliable way to test Traffic Ops, as they are expected to fail more and more as functionality is stripped from the Perl codebase.</p>
</div>
<div class="section" id="the-kabletown-cdn-example">
<h3>The KableTown CDN example<a class="headerlink" href="#the-kabletown-cdn-example" title="Permalink to this headline">¶</a></h3>
<p>The integration tests will load an example CDN with most of the features of Traffic Control being used. This is mostly for testing purposes, but can also be used as an example of how to configure certain features. To load the KableTown CDN example and access it:</p>
<ol class="arabic">
<li><p>Be sure the integration tests have been run</p></li>
<li><p>Start the Traffic Ops server. The <span class="target" id="index-0"></span><a class="reference internal" href="#envvar-MOJO_MODE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">MOJO_MODE</span></code></a> environment variable should be set to the name of the environment that has been loaded.</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-number">#82 </span><span class="caption-text">Example Startup</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">MOJO_MODE</span><span class="o">=</span>integration
<span class="nb">cd</span> app/
bin/start.pl
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>Using a web browser, navigate to the address Traffic Ops is serving, e.g. <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:3000</span></code> for default settings</p></li>
<li><p>For the initial log in:</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">User name</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">admin</span></code></p>
</dd>
<dt class="field-even">Password</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">password</span></code></p>
</dd>
</dl>
</div></blockquote>
</li>
</ol>
</div>
</div>
<div class="section" id="extensions">
<h2>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h2>
<p>Traffic Ops Extensions are a way to enhance the basic functionality of Traffic Ops in a customizable manner. There are two types of extensions:</p>
<dl class="simple">
<dt><a class="reference internal" href="../admin/traffic_ops/extensions.html#to-check-ext"><span class="std std-ref">Check Extensions</span></a></dt><dd><p>These allow you to add custom checks to the <span class="menuselection">Monitor ‣ Cache Checks</span> view.</p>
</dd>
<dt><a class="reference internal" href="../admin/traffic_ops/extensions.html#to-datasource-ext"><span class="std std-ref">Data Source Extensions</span></a></dt><dd><p>These allow you to add statistic sources for the graph views and APIs.</p>
</dd>
</dl>
<p>Extensions are managed using the <code class="docutils literal notranslate"><span class="pre">$TO_HOME/bin/extensions</span></code> command line script</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For more information see <a class="reference internal" href="../admin/traffic_ops/extensions.html#admin-to-ext-script"><span class="std std-ref">Managing Traffic Ops Extensions</span></a>.</p>
</div>
<div class="section" id="extensions-at-runtime">
<h3>Extensions at Runtime<a class="headerlink" href="#extensions-at-runtime" title="Permalink to this headline">¶</a></h3>
<p>The search path for <a class="reference internal" href="../admin/traffic_ops/extensions.html#to-datasource-ext"><span class="std std-ref">Data Source Extensions</span></a> depends on the configuration of the <code class="docutils literal notranslate"><span class="pre">PERL5LIB</span></code> environment variable, which is pre-configured in the Traffic Ops start scripts. All <a class="reference internal" href="../admin/traffic_ops/extensions.html#to-check-ext"><span class="std std-ref">Check Extensions</span></a> must be located in <code class="docutils literal notranslate"><span class="pre">$TO_HOME/bin/checks</span></code></p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-number">#83 </span><span class="caption-text">Example <code class="docutils literal notranslate"><span class="pre">PERL5LIB</span></code> Configuration</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PERL5LIB</span><span class="o">=</span>/opt/traffic_ops_extensions/private/lib/Extensions:/opt/traffic_ops/app/lib/Extensions/TrafficStats
</pre></div>
</div>
</div>
</div></blockquote>
<p>To prevent <a class="reference internal" href="../admin/traffic_ops/extensions.html#to-datasource-ext"><span class="std std-ref">Data Source Extensions</span></a> namespace collisions within Traffic Ops all <a class="reference internal" href="../admin/traffic_ops/extensions.html#to-datasource-ext"><span class="std std-ref">Data Source Extensions</span></a> should follow the package naming convention ‘<code class="docutils literal notranslate"><span class="pre">Extensions::&lt;ExtensionName&gt;</span></code>’</p>
</div>
<div class="section" id="trafficopsroutes-pm">
<h3><code class="docutils literal notranslate"><span class="pre">TrafficOpsRoutes.pm</span></code><a class="headerlink" href="#trafficopsroutes-pm" title="Permalink to this headline">¶</a></h3>
<p>Traffic Ops accesses each extension through the addition of a URL route as a custom hook. These routes will be defined in a file called <code class="docutils literal notranslate"><span class="pre">TrafficOpsRoutes.pm</span></code> that should be present in the top directory of your Extension. The routes that are defined should follow the <a class="reference external" href="https://mojolicious.org/perldoc/Mojolicious/Guides/Routing#Routes">Mojolicious route conventions</a>.</p>
</div>
<div class="section" id="development-configuration">
<h3>Development Configuration<a class="headerlink" href="#development-configuration" title="Permalink to this headline">¶</a></h3>
<p>To incorporate any custom <a class="reference internal" href="../admin/traffic_ops/extensions.html#to-datasource-ext"><span class="std std-ref">Data Source Extensions</span></a> during development set your <code class="docutils literal notranslate"><span class="pre">PERL5LIB</span></code> environment variable with any number of colon-separated directories with the understanding that the <code class="docutils literal notranslate"><span class="pre">PERL5LIB</span></code> search order is from left to right through this list. Once Perl locates your custom route or Perl package/class it ‘pins’ on that class or Mojolicious Route and doesn’t look any further, which allows for the developer to override Traffic Ops functionality.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="traffic_ops_golang.html" class="btn btn-neutral float-right" title="Traffic Ops - Go" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="building.html" class="btn btn-neutral" title="Building Traffic Control" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Traffic Control

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>